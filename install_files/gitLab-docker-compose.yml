
services:
  gitlab:
    image: 'gitlab/gitlab-ce:latest'
    container_name: gitlab
    restart: always
    hostname: 'gitlab.local'  # ⚠️ Remplacez par votre domaine ou IP publique si besoin
    environment:
      GITLAB_OMNIBUS_CONFIG: |
        external_url 'http://gitlab.local'  # ⚠️ Doit correspondre à ce que les clients utiliseront
        # Désactiver HTTPS si vous n'avez pas de certificat (à n'utiliser qu'en dev ou avec reverse proxy)
        nginx['listen_https'] = false
        # Optionnel : configurer l'envoi d'emails (ex: via SMTP)
        # gitlab_rails['smtp_enable'] = true
        # gitlab_rails['smtp_address'] = "smtp.example.com"
    ports:
      - '80:80'      # HTTP
      - '443:443'    # HTTPS (inactif si nginx['listen_https'] = false)
      - '2222:22'    # SSH personnalisé (évite conflit avec SSH hôte)
    volumes:
      - './gitlab/config:/etc/gitlab'
      - './gitlab/logs:/var/log/gitlab'
      - './gitlab/data:/var/opt/gitlab'
    shm_size: '256m'  # Recommandé pour éviter les problèmes de performance